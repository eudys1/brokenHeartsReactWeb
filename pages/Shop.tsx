import Head from 'next/head'
import {  useState } from 'react';
import Header from "../components/Header";
import Modal from '../components/Modal';
import NewProductForm from '../components/NewProductForm';

import ProductWithModal from '../components/ProductWithModal';
import { useFirestorage } from '../hooks/useFirestorage';
import { useShopingCart } from '../context/shopingCartContext';

export default function Shop() {
    const [productData, setProductData] = useState<any>(null);
    const [docs] = useFirestorage("products");
    const { shopingCart, setShopingCart, getNumberOfDifferentItems }: any = useShopingCart();


    function addToShopingCart(product: any) {

        const shopingCartProduct: any = {};
        shopingCartProduct.quantity = 1;
        shopingCartProduct.product = product;
        shopingCartProduct.productId = product.id;


        //keepping all the products in the shoping cart and adding new ones
        setShopingCart([...shopingCart, shopingCartProduct], product);
    }


    return (
        <>
            <Head>
                <title>Tienda</title>
                <meta name="merchandising" content="Generated by Broken Hearts" />
                <link rel="icon" href="/favicon.ico" />

            </Head>

            <Header className=' justify-between ' />
            <div className="pt-28">


                {/* CREAR NUEVO PRODUCTO: */}
                <Modal
                    elementShownWhenModalIsClose={
                        <button className=" flex mx-auto rounded-md bg-black bg-opacity-20 px-4 py-2 text-sm font-medium text-white hover:bg-opacity-30 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75">
                            Crear producto
                        </button>
                    }
                    openModalButtonTitle='Crear producto'
                    modalTitle='Crea un nuevo producto'
                    cerrarModal={false}
                    modalDescription={<NewProductForm setProductData={setProductData} />}
                />

                <div className=" w-[80%] mx-auto p-5">

                    {/* PRODUCTOS: */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-5 lg:gap-7">

                        {docs.map((item: any, index: number) => {

                            return (
                                <div key={index} className="">
                                    <ProductWithModal productData={item} />
                                    <button onClick={() => addToShopingCart(item)} className="mt-5 w-fit mx-auto px-5 py-3 block bg-slate-400 rounded text-white">AÃ±adir al carrito</button>
                                </div>
                            )
                        })
                        }
                    </div>

                </div>
            </div>

        </>
    )
}